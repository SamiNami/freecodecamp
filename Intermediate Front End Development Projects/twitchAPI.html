<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- import jquery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!-- import bootstrap -->
  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css'>

</head>

<script>

$(document).ready(function(){
  // array for the streams I want to GET
  var streams = ["ESL_SC2", "freecodecamp", "summit1g", "brunofin"];
  // arrays to store the data in
  var check =[];
  var checkOnline = [];

  streams.forEach(function(stream){

    $.getJSON("https://wind-bow.gomix.me/twitch-api/channels/"+ stream +"",function(json){
      // if the status is 404, html becomes deleted
      if(json.status === 404){
        // add exist false
        check.push({ name: stream, exists: false });
      }
      else{
        // add exist true, gets the image, get url
        check.push({ name: stream, exists: true, image: json.logo, url: json.url });

      }
      // checks if all JSON requests have arrived (once the check is same lenght as streams)
      if (check.length === streams.length){

        streams.forEach(function(stream){
          $.getJSON("https://wind-bow.gomix.me/twitch-api/streams/"+ stream +"",function(json){
          if (json.stream === null ){
            checkOnline.push({ name: stream, status: "offline" });
          }
          else{
            checkOnline.push({ name: stream, status: "online", extra: json.stream.channel.status });
          }
          if (checkOnline.length === streams.length){

            console.log(check[0].name);
            // sort both arrays so they are in the same order
            check.sort(compare);
            checkOnline.sort(compare);

            // add the data to the CSS
            // still need to add the classes
            for (i = 0; i < check.length; i++){
              if (check[i].exists === false){
                $( "#targetImage" ).append( "<div class ='logo'> Placeholder </div><br>" );
                $( "#targetLink" ).append( "<div class ='logo'> Placeholder </div><br>" );
                $( "#targetInfo" ).append( "<div class ='logo'> "+ check[i].name +" has been deleted  </div><br>" );
              }
              else if (check[i].exists === true){
                $( "#targetImage" ).append( "<div class ='logo'> " + check[i].image + " </div><br>" );
                $( "#targetLink" ).append( "<div class ='logo'> " + check[i].url + " </div><br>" );

                if(checkOnline[i].status === "offline" ){
                  $( "#targetInfo" ).append( "<div class ='logo'> "+ check[i].name +" is offline </div><br>" );
                }
                else if(checkOnline[i].status === "online" ){
                  $( "#targetInfo" ).append( "<div class ='logo'> "+ checkOnline[i].extra +" </div><br>" );
                }
              }
            }
          } // I made a slide!
          });
        });
      }
    });
  });
});


// sorting function for the arrays
function compare(a,b) {
    if (a.name < b.name)
      return -1;
    if (a.name > b.name)
      return 1;
    return 0;
  }

</script>


<html>

  <div class="container well" >

    <div class = "row text-center">

      <div class = "col-xs-12  ">
        <h1>Twitch API</h1>
      </div>

    </div>

    <div class = "row text-center">
      <!--  target div for the logo -->
      <div class = "col-xs-3" id="targetImage">Image </div>
      <!--  target div for the stream link -->
      <div class = "col-xs-3" id="targetLink">Link </div>
      <!--  target div for the stream info-->
      <div class = "col-xs-6" id="targetInfo">Info</div>



   </div>
  </div>

</html>
